
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Podman and Harbor &#8212; erisDocs 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=e1a75a79"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'containers';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">erisDocs 0.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/containers.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Podman and Harbor</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pulling-an-existing-image">Pulling an Existing Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-an-existing-image">Customizing an Existing Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#podman-settings">Podman Settings</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <!-- # Using Containers -->
<p>If you want to run code in a reproducible, easy to share environment, Docker containers and images are excellent vehicles for running this code. Briefly and non-technically, running a Docker container is like running a computationally inexpensive isolated computer inside of your computer. The instructions for making the container come from the image. For more information on Docker containers and images, check out <a class="reference external" href="https://aws.amazon.com/compare/the-difference-between-docker-images-and-containers/">this article from AWS</a>. For a brief primer on making your own Docker images, check out <a class="reference external" href="https://containers-at-tacc.readthedocs.io/en/latest/containerize-your-code/overview.html">this article from TACC</a>.</p>
<section id="podman-and-harbor">
<h1>Podman and Harbor<a class="headerlink" href="#podman-and-harbor" title="Link to this heading">#</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A lot of the official documentation is <strong>very</strong> loose with the terms container and image. When you are on ERISXdl, the end point is building an image which will in turn make a container that runs your code. Remember that images are templates for building containers. This might seem pedantic but is important when communicating to other technical people and important for not confusing new users. As a general rule:</p>
<p>✅ You can push and pull a docker image and use it to make a container.</p>
<p>❌ You can’t push and pull a docker container, but you can use it to run code.</p>
</div>
<p>ERISXdl uses two services called podman and Harbor. Podman is used because it provides extra security. For all intents and purposes, its syntax is largely interchangeable with docker’s commands.</p>
<p>Harbor is a private container registry used by ERISXdl that you can use to push images. Harbor is used because ERISXdl is not connected to the internet but you will still want to access images.</p>
<p>When you submit your job, you will specify the image you want by using a Harbor location. A wrapper script will be run that spins up a container using this image, then subsequently runs your job in that container. With podman/docker on the command line, Harbor will be referred to as erisxdl.partners.org.</p>
<p><em>Adapted from <a class="reference external" href="https://rc.partners.org/kb/article/3718">https://rc.partners.org/kb/article/3718</a></em></p>
<section id="pulling-an-existing-image">
<h2>Pulling an Existing Image<a class="headerlink" href="#pulling-an-existing-image" title="Link to this heading">#</a></h2>
<p>Docker can be extremely <a class="reference external" href="https://docs.docker.com/engine/security/">insecure and dangerous to run</a>. So exercise caution when pulling a new Docker image, especially if you are on your personal machine and not using podman.</p>
<p>Let’s practice using podman by grabbing an image, tagging it, then uploading it to Harbor.</p>
<ol class="arabic">
<li><p>Login to the registry you want to use:</p>
<p>You can use dockerhub directly:</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">login</span> <span class="pre">docker.io</span></code></p>
<p>or use Harbor:</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">login</span> <span class="pre">erisxdl.partners.org</span></code></p>
<p>Remember: erisxdl.partners.org == Harbor</p>
</li>
<li><p>Search for an image (in this case a lightweight Linux distribution, Alpine Linux):</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">search</span> <span class="pre">docker.io/alpine</span></code></p>
</li>
<li><p>Pull the image</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">pull</span> <span class="pre">docker.io/library/alpine</span></code></p>
<p>We can view the image with <code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">images</span></code> or <code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">image</span> <span class="pre">ls</span></code>. It will look something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>REPOSITORY<span class="w">                 </span>TAG<span class="w">      </span>IMAGE<span class="w"> </span>ID<span class="w">       </span>CREATED<span class="w">       </span>SIZE
docker.io/library/alpine<span class="w">   </span>latest<span class="w">   </span>91ef0af61f39<span class="w">   </span><span class="m">2</span><span class="w"> </span>weeks<span class="w"> </span>ago<span class="w">   </span><span class="m">8</span>.09<span class="w"> </span>MB
</pre></div>
</div>
</li>
<li><p>Tag the image:</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">tag</span> <span class="pre">91ef0af61f39</span> <span class="pre">erisxdl.partners.org/&lt;PAS</span> <span class="pre">Group</span> <span class="pre">Name</span> <span class="pre">in</span> <span class="pre">lowercase&gt;/alpine:demo-copy</span></code></p>
<p>Notice that we are specifying our image using its <code class="docutils literal notranslate"><span class="pre">IMAGE</span> <span class="pre">ID</span></code> and specifying Harbor as the registry.</p>
</li>
<li><p>Push the image to Harbor</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">push</span> <span class="pre">erisxdl.partners.org/&lt;PAS</span> <span class="pre">Group</span> <span class="pre">Name</span> <span class="pre">in</span> <span class="pre">lowercase&gt;/alpine:demo-copy</span></code></p>
</li>
</ol>
<p>If you wanted to, you could now use this image for running your code through a submitted job.</p>
</section>
<section id="customizing-an-existing-image">
<h2>Customizing an Existing Image<a class="headerlink" href="#customizing-an-existing-image" title="Link to this heading">#</a></h2>
<p>If you spin up a container from an image, this gives you root access to the container. This means you could install python, a package manager, etc inside the container. You could then commit these changes to a new image, then upload this to Harbor and use it.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Author’s Note</strong>
Customizing an existing image is an extremely convenient feature. However, other than a record of file changes, there is very little reproducibility in this. It is highly recommended (by me) that you create dockerfiles that generate images you can use.</p>
</div>
<p>Here is an example of getting a basic Ubuntu image and adding <code class="docutils literal notranslate"><span class="pre">curl</span></code> to it:</p>
<ol class="arabic">
<li><p>Pull the container from Harbor:
<code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">pull</span> <span class="pre">docker.io/ubuntu:22.04</span></code></p>
<p>Again we can view the container with <code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">images</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>REPOSITORY<span class="w">                 </span>TAG<span class="w">     </span>IMAGE<span class="w"> </span>ID<span class="w">       </span>CREATED<span class="w">       </span>SIZE
docker.io/library/ubuntu<span class="w">   </span><span class="m">22</span>.04<span class="w">   </span>97271d29cb79<span class="w">   </span><span class="m">2</span><span class="w"> </span>weeks<span class="w"> </span>ago<span class="w">   </span><span class="m">80</span>.4<span class="w"> </span>MB
</pre></div>
</div>
<p>Note the image ID.</p>
</li>
<li><p>Run the container:
<code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">run</span> <span class="pre">-it</span> <span class="pre">97271d29cb79</span> <span class="pre">/bin/bash</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">-it</span></code> flag opens and interactive terminal and is very common.</p>
<p>Then install curl and verify it’s working:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@54116e44f656:/#<span class="w"> </span>apt-get<span class="w"> </span>upgrade
root@54116e44f656:/#<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>curl
root@54116e44f656:/#<span class="w"> </span>curl<span class="w"> </span>cht.sh/docker
root@54116e44f656:/#<span class="w"> </span><span class="nb">exit</span>
</pre></div>
</div>
<p>Now we have a running container that has both Ubuntu and <code class="docutils literal notranslate"><span class="pre">curl</span></code>.</p>
</li>
<li><p>View the running containers:
<code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">ps</span> <span class="pre">-a</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CONTAINER<span class="w"> </span>ID<span class="w">  </span>IMAGE<span class="w">                           </span>COMMAND<span class="w">    </span>CREATED<span class="w">         </span>STATUS<span class="w">                    </span>PORTS<span class="w">  </span>NAMES
1af08557edbe<span class="w">  </span>docker.io/library/ubuntu:22.04<span class="w">  </span>/bin/bash<span class="w">  </span><span class="m">11</span><span class="w"> </span>minutes<span class="w"> </span>ago<span class="w">  </span>Exited<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">         </span>eager_blackburn
</pre></div>
</div>
<p>You might note that containers have both a <code class="docutils literal notranslate"><span class="pre">CONTAINER</span> <span class="pre">ID</span></code> and a <code class="docutils literal notranslate"><span class="pre">NAME</span></code>.</p>
</li>
<li><p>Commit the container to a new image:</p>
<p><code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">commit</span> <span class="pre">1af08557edbe</span> <span class="pre">erisxdl.partners.org/&lt;PAS</span> <span class="pre">Group</span> <span class="pre">Name</span> <span class="pre">in</span> <span class="pre">lowercase&gt;/ubuntu:now-with-curl</span></code></p>
<p>Our image should be named ubuntu:now-with-curl.</p>
<p>Remember: Your tag gives information but it will be hard to keep up with things like versioning and encompassing all changes through a tag alone.</p>
</li>
</ol>
</section>
<section id="podman-settings">
<h2>Podman Settings<a class="headerlink" href="#podman-settings" title="Link to this heading">#</a></h2>
<p><em>This comes directly from partners</em></p>
<p>On ERISXdl there are three login nodes, erisxdl1, erisxdl2 and erisxdl3 and where each will contain differing collections of locally-stored images stored under</p>
<p><code class="docutils literal notranslate"><span class="pre">/erisxdl[1-3]/local/storage</span></code></p>
<p>In order to ensure the user has access to the images on a given node please locate the following file in the home directory</p>
<p><code class="docutils literal notranslate"><span class="pre">~/.config/containers/storage.conf</span></code></p>
<p>and make the following change using your favorite text editor:</p>
<p><code class="docutils literal notranslate"><span class="pre">graphroot</span> <span class="pre">=</span> <span class="pre">&quot;/erisxdl/local/storage/abc123&quot;</span></code></p>
<p>where abc123 corresponds to the userid. By this means podman will operate normally on all 3 login nodes, even in the case of node failure. However, the images available on each node will be different. The images stored in Harbor at</p>
<p><code class="docutils literal notranslate"><span class="pre">erisxdl.partners.org/&lt;PAS</span> <span class="pre">Group</span> <span class="pre">Name</span> <span class="pre">in</span> <span class="pre">lowercase&gt;</span></code></p>
<p>will of course always be available. If there is trouble please submit a request to hpcsupport to run</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">./podman_reset.sh</span> <span class="pre">&lt;userID&gt;</span> <span class="pre">/erisxdl/local/storage</span></code></p>
<p>Finally, please note that on each of the login nodes erisxdl[1-3] a user will have a quota of 50GB (as of 2024/01) for the storage of local images. The current consumption of storage under</p>
<p><code class="docutils literal notranslate"><span class="pre">/erisxdl[1-3]/local/storage/&lt;userID&gt;</span></code></p>
<p>can be displayed with the following terminal command:</p>
<p><code class="docutils literal notranslate"><span class="pre">quota</span> <span class="pre">-vs</span></code></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pulling-an-existing-image">Pulling an Existing Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-an-existing-image">Customizing an Existing Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#podman-settings">Podman Settings</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tyler A. Jost
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Tyler A. Jost.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>